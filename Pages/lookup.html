<!DOCTYPE html>
<html>
<head>
    <title>Operation Blue Roof Status Lookup</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        h2 {
            color: #3366CC;
        }
        label, input, button {
            display: block;
            width: 100%;
            margin-bottom: 20px;
        }
        button {
            padding: 10px;
            background-color: #3366CC;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #285e8e;
        }
        #result {
            border: 1px solid #3366CC;
            padding: 10px;
            color: #3366CC;
            display: none;
        }
    </style>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>

</head>
<body>
    <div class="container">
        <label for="roeidpk">Enter your ROE Number or Reference Number:</label>
        <input type="text" id="searchid" name="searchid">
        <label for="pin">Enter your PIN:</label>
        <input type="password" id="pin" name="pin">
        <button id="submit">Submit</button>
        <p id="result"></p>
    </div>

    <script>
    $("#submit").click(function(){
        var searchid = $("#searchid").val();
        var pin = $("#pin").val();

        $.ajax({
            url: "https://arcportal-ucop-corps.usace.army.mil/esf3/rest/services/TempRoofing/BRMS/FeatureServer/0/query",
            data: {
                f: 'json',
                where: "(roeidpk = '" + searchid + "' OR appreferencenumber = '" + searchid + "') AND apppinnumber = '" + pin + "'",
                outFields: 'workstate, progressstatus,OBJECTID',
            },
            success: function(data) {
                var message = "";
                if (data.features.length > 0) {
                    var attributes = data.features[0].attributes;
                    if (attributes.workstate == 'Valid') {
                        message += "Your application for Temporary Roofing repairs is currently valid and is actively being worked.<br>";
                    }
                    if (attributes.progressstatus == 'Awaiting Remote QA Assignment') {
                        message += "Your application is waiting for damage assessment by a member of our field team. You may soon be contacted by Corps of Engineers personnel to discuss your damages.<br>";
                    }
                    // Add more conditions here if necessary
                } else {
                    message = "No matching record found.";
                }
                $("#result").html(message);
                $("#result").show(); // Show the result

                // Fetch and display image attachments
                if (data.features.length > 0) {
                    $.ajax({
                        url: "https://arcportal-ucop-corps.usace.army.mil/esf3/rest/services/TempRoofing/BRMS/FeatureServer/0/" + data.features[0].attributes.OBJECTID + "/attachments?f=json",
                        success: function(attachmentData) {
    if (attachmentData.attachmentInfos && attachmentData.attachmentInfos.length > 0) {
        for (var i = 0; i < attachmentData.attachmentInfos.length; i++) {
            var imageUrl = "https://arcportal-ucop-corps.usace.army.mil/esf3/rest/services/TempRoofing/BRMS/FeatureServer/0/" + data.features[0].attributes.OBJECTID + "/attachments/" + attachmentData.attachmentInfos[i].id;
            $("#result").append("<a href='" + imageUrl + "' class='mfp-image'><img src='" + imageUrl + "' alt='Image' style='width:100px; height:100px;'></a>");
        }
        $('.mfp-image').magnificPopup({type:'image'});
    }
},
                        error: function(jqXHR, textStatus, errorThrown) {
                            // Error handling
                            alert("Error getting attachments: " + textStatus + "\n" + errorThrown);
                        }
                    });
                }
            },
            error: function(jqXHR, textStatus, errorThrown) {
                // Error handling
                alert("Error: " + textStatus + "\n" + errorThrown);
            }
        });
    });
</script>

</body>
</html>
